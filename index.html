<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Epic FHIR EHR Assistant</title>
    <link rel="stylesheet" href="/src/style.css" />
</head>

<body>
    <div id="app" class="desktop-layout">
        <!-- Main Header -->
        <header class="app-header">
            <div class="header-left">
                <button id="sidebar-toggle" class="sidebar-toggle" title="Hide patient data">‚óÄÔ∏è</button>
                <h1 class="app-title">
                    <span class="icon">üí¨</span>
                    EHR Assistant
                </h1>
            </div>
            <div class="header-right">
                <div class="context-indicators">
                    <span id="patient-indicator" class="context-indicator enabled">‚úì</span>
                    <span id="vitals-indicator" class="context-indicator enabled">‚úì</span>
                    <span id="meds-indicator" class="context-indicator enabled">‚úì</span>
                    <span id="encounters-indicator" class="context-indicator enabled">‚úì</span>
                    <span id="conditions-indicator" class="context-indicator enabled">‚úì</span>
                    <span id="enhanced-indicator" class="context-indicator enabled">‚úì</span>
                </div>
                <button class="settings-btn">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- Main Layout Container -->
        <div class="layout-container">
            <!-- Patient Data Sidebar -->
            <aside id="patient-sidebar" class="patient-sidebar">
                <!-- Patient Summary Card -->
                <div id="patient-summary-card" class="patient-summary-card">
                    <div class="summary-header">
                        <h3>Loading Patient...</h3>
                    </div>
                </div>

                <!-- Data Preview Cards -->
                <div class="data-preview-grid">
                    <div class="preview-card">
                        <div class="preview-header">
                            <span class="icon">üìã</span>
                            <span class="preview-title">Recent Vitals</span>
                            <span id="toggle-vitals" class="toggle-btn">‚úì</span>
                        </div>
                        <div id="vitals-preview" class="preview-content">
                            Loading...
                        </div>
                    </div>

                    <div class="preview-card">
                        <div class="preview-header">
                            <span class="icon">üíä</span>
                            <span class="preview-title">Current Meds</span>
                            <span id="toggle-meds" class="toggle-btn">‚úì</span>
                        </div>
                        <div id="meds-preview" class="preview-content">
                            Loading...
                        </div>
                    </div>

                    <div class="preview-card">
                        <div class="preview-header">
                            <span class="icon">üè•</span>
                            <span class="preview-title">Recent Visits</span>
                            <span id="toggle-encounters" class="toggle-btn">‚úì</span>
                        </div>
                        <div id="encounters-preview" class="preview-content">
                            Loading...
                        </div>
                    </div>

                    <div class="preview-card">
                        <div class="preview-header">
                            <span class="icon">ü©∫</span>
                            <span class="preview-title">Active Problems</span>
                            <span id="toggle-conditions" class="toggle-btn">‚úì</span>
                        </div>
                        <div id="conditions-preview" class="preview-content">
                            Loading...
                        </div>
                    </div>
                </div>

                <!-- Data Tabs -->
                <div class="data-tabs">
                    <div class="tab-header">
                        <button class="tab-btn active" data-tab="overview">Overview</button>
                        <button class="tab-btn" data-tab="vitals">Vitals</button>
                        <button class="tab-btn" data-tab="meds">Medications</button>
                        <button class="tab-btn" data-tab="encounters">Encounters</button>
                        <button class="tab-btn" data-tab="conditions">Problems</button>
                    </div>

                    <!-- Tab Contents -->
                    <div id="overview-tab" class="tab-content" style="display: block;">
                        <div class="overview-summary">
                            <h4>Data Context Settings</h4>
                            <div class="context-controls">
                                <div class="context-item">
                                    <span id="toggle-patient" class="context-toggle">
                                        <span class="icon">üë§</span> Demographics
                                    </span>
                                </div>
                                <div class="context-item">
                                    <span id="toggle-enhanced" class="context-toggle">
                                        <span class="icon">ü§ñ</span> Enhanced AI Mode
                                    </span>
                                </div>
                            </div>
                            
                            <h4>Suggested Questions</h4>
                            <div class="suggested-questions">
                                <button class="suggested-question">What are the patient's most recent vital signs?</button>
                                <button class="suggested-question">Show me all active medications</button>
                                <button class="suggested-question">What problems are currently active?</button>
                                <button class="suggested-question">Summarize recent visits</button>
                                <button class="suggested-question">Are there any medication interactions?</button>
                                <button class="suggested-question">Show lab trends over the last year</button>
                            </div>
                        </div>
                    </div>

                    <div id="vitals-tab" class="tab-content">
                        <div id="vitals-full-data" class="full-data-container">
                            Loading vital signs...
                        </div>
                    </div>

                    <div id="meds-tab" class="tab-content">
                        <div id="meds-full-data" class="full-data-container">
                            Loading medications...
                        </div>
                    </div>

                    <div id="encounters-tab" class="tab-content">
                        <div id="encounters-full-data" class="full-data-container">
                            Loading encounters...
                        </div>
                    </div>

                    <div id="conditions-tab" class="tab-content">
                        <div id="conditions-full-data" class="full-data-container">
                            Loading conditions...
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Chat Area -->
            <main id="main-area" class="main-area">
                <!-- Loading indicator -->
                <div id="loading" class="loading-overlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div>Loading patient data...</div>
                </div>

                <!-- Chat Container -->
                <div class="chat-container">
                    <!-- Chat History -->
                    <div id="chat-history" class="chat-history">
                        <div class="welcome-message">
                            <div class="welcome-header">
                                <span class="icon">ü§ñ</span>
                                <h3>Welcome to EHR Assistant</h3>
                            </div>
                            <p>I can help you analyze patient data, answer questions about medications, vitals, conditions, and more. Ask me anything about this patient!</p>
                            <div class="quick-start">
                                <strong>Quick Start:</strong>
                                <ul>
                                    <li>Ask about recent lab results or vital signs</li>
                                    <li>Review medication interactions or changes</li>
                                    <li>Summarize recent visits or diagnoses</li>
                                    <li>Analyze trends over time</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Input Area -->
                    <div class="chat-input-container">
                        <div class="input-wrapper">
                            <textarea 
                                id="chat-input" 
                                placeholder="Ask about this patient's health data..." 
                                class="chat-input"
                                rows="1"
                            ></textarea>
                            <button id="chat-submit" class="chat-submit" title="Send message">
                                üîç
                            </button>
                        </div>
                        
                        <div class="input-footer">
                            <div class="input-actions">
                                <button id="clear-chat" class="action-btn" title="Clear conversation">
                                    <span class="icon">üóëÔ∏è</span> Clear
                                </button>
                                <button class="action-btn" title="Export conversation">
                                    <span class="icon">üì•</span> Export
                                </button>
                            </div>
                            
                            <div class="status-info">
                                <span class="connection-status">üü¢ SMART on FHIR Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Hidden sections for OAuth/debugging info (keep these for functionality) -->
        <div style="display:none;">
            <div id="launch-token-data-wrapper">
                <pre id="launch-token-json"></pre>
            </div>
            <div id="auth-details-wrapper">
                <p>Access Token: <code id="access-token-display"></code></p>
                <p>Patient ID: <code id="patient-id-display"></code></p>
                <p>FHIR Server (iss): <code id="fhir-server-display"></code></p>
                <h4>Full Token Response:</h4>
                <pre id="token-response-display"></pre>
            </div>
        </div>
    </div>
    
    <script type="module" src="/src/main.js"></script>
</body>

</html>
                